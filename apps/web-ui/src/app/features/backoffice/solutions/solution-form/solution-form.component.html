<div class="solution-form-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h3>{{ isEditMode ? 'Update solution information' : 'Add a new solution' }}</h3>
    </div>
  </div>

  <!-- Form and Debug Section -->
  <div class="form-and-debug-container">
    <!-- Form Section -->
    <div class="form-section">
      <app-form-debug-link
        [formGroup]="solutionForm"
        [title]="'Solution Form Debug'"
        [showValues]="true"
        [showErrors]="true"
        [showStatus]="true"
        [collapsed]="false"
        [linkText]="'Debug Form'"
        class="form-debug-link-top"
      ></app-form-debug-link>

      <form nz-form [formGroup]="solutionForm" (ngSubmit)="onSubmit()" [nzLayout]="'vertical'">
        <!-- Two Column Layout -->
        <div class="cards-row">
          <!-- Basic Information Section -->
          <div class="column-section">
            <h3 class="section-title">Basic Information</h3>
            <!-- Name Field -->
            <nz-form-item>
              <nz-form-label nzRequired>Solution Name</nz-form-label>
              <nz-form-control [nzErrorTip]="getFieldError('name')">
                <input
                  nz-input
                  formControlName="name"
                  placeholder="Enter solution name"
                  [class.error]="isFieldInvalid('name')"
                />
              </nz-form-control>
            </nz-form-item>

            <!-- App Code Field -->
            <nz-form-item>
              <nz-form-label nzRequired>App Code</nz-form-label>
              <nz-form-control [nzErrorTip]="getFieldError('appCode')" nzExtra="A unique numeric identifier for the solution">
                <nz-input-number
                  formControlName="appCode"
                  [nzMin]="1"
                  [nzMax]="999999"
                  placeholder="Enter app code"
                  style="width: 100%"
                  [class.error]="isFieldInvalid('appCode')"
                ></nz-input-number>
              </nz-form-control>
            </nz-form-item>

            <!-- Description Field -->
            <nz-form-item>
              <nz-form-label nzRequired>Description</nz-form-label>
              <nz-form-control [nzErrorTip]="getFieldError('description')">
                <textarea
                  nz-input
                  formControlName="description"
                  placeholder="Enter solution description"
                  [nzAutosize]="{ minRows: 3, maxRows: 6 }"
                  [class.error]="isFieldInvalid('description')"
                ></textarea>
              </nz-form-control>
            </nz-form-item>

            <!-- Active Status Field -->
            <nz-form-item>
              <nz-form-label>Active</nz-form-label>
              <nz-form-control>
                <nz-switch formControlName="isActive"></nz-switch>
                <span class="ml-2">{{ solutionForm.get('isActive')?.value ? 'Active' : 'Inactive' }}</span>
              </nz-form-control>
            </nz-form-item>
          </div>

          <!-- Communication Settings Section -->
          <div class="column-section column-separator">
            <h3 class="section-title">Communication Settings (Optional)</h3>
            <nz-collapse>
            <!-- Email Settings -->
            <nz-collapse-panel
              nzHeader="Email Settings"
              [(nzActive)]="communicationPanelsActive.email"
            >
              <div formGroupName="emailSettings">
                <nz-form-item>
                  <nz-form-label>Enable Email</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more email-specific fields here -->
              </div>
            </nz-collapse-panel>

            <!-- SMS Settings -->
            <nz-collapse-panel
              nzHeader="SMS Settings"
              [(nzActive)]="communicationPanelsActive.sms"
            >
              <div formGroupName="smsSettings">
                <nz-form-item>
                  <nz-form-label>Enable SMS</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more SMS-specific fields here -->
              </div>
            </nz-collapse-panel>

            <!-- Slack Settings -->
            <nz-collapse-panel
              nzHeader="Slack Settings"
              [(nzActive)]="communicationPanelsActive.slack"
            >
              <div formGroupName="slackSettings">
                <nz-form-item>
                  <nz-form-label>Enable Slack</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more Slack-specific fields here -->
              </div>
            </nz-collapse-panel>

            <!-- IVR Settings -->
            <nz-collapse-panel
              nzHeader="IVR Settings"
              [(nzActive)]="communicationPanelsActive.ivr"
            >
              <div formGroupName="ivrSettings">
                <nz-form-item>
                  <nz-form-label>Enable IVR</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more IVR-specific fields here -->
              </div>
            </nz-collapse-panel>

            <!-- Facebook Settings -->
            <nz-collapse-panel
              nzHeader="Facebook Settings"
              [(nzActive)]="communicationPanelsActive.facebook"
            >
              <div formGroupName="facebookSettings">
                <nz-form-item>
                  <nz-form-label>Enable Facebook</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more Facebook-specific fields here -->
              </div>
            </nz-collapse-panel>

            <!-- Google Analytics Settings -->
            <nz-collapse-panel
              nzHeader="Google Analytics Settings"
              [(nzActive)]="communicationPanelsActive.googleAnalytics"
            >
              <div formGroupName="googleAnalyticsSettings">
                <nz-form-item>
                  <nz-form-label>Enable Google Analytics</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more Google Analytics-specific fields here -->
              </div>
            </nz-collapse-panel>

            <!-- Journey Settings -->
            <nz-collapse-panel
              nzHeader="Journey Settings"
              [(nzActive)]="communicationPanelsActive.journey"
            >
              <div formGroupName="journeySettings">
                <nz-form-item>
                  <nz-form-label>Enable Journey</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more Journey-specific fields here -->
              </div>
            </nz-collapse-panel>

            <!-- External Bucket Settings -->
            <nz-collapse-panel
              nzHeader="External Bucket Settings"
              [(nzActive)]="communicationPanelsActive.externalBucket"
            >
              <div formGroupName="externalBucketSettings">
                <nz-form-item>
                  <nz-form-label>Enable External Bucket</nz-form-label>
                  <nz-form-control>
                    <nz-switch formControlName="enabled"></nz-switch>
                  </nz-form-control>
                </nz-form-item>
                <!-- Add more External Bucket-specific fields here -->
              </div>
            </nz-collapse-panel>
            </nz-collapse>
          </div>
        </div>

        <!-- Form Actions -->
        <nz-form-item class="form-actions mt-3">
          <nz-form-control>
            <div class="form-action-buttons">
              <button nz-button type="button" (click)="onCancel()" [disabled]="loading">
                <span nz-icon nzType="close"></span>
                Cancel
              </button>
              <button
                nz-button
                nzType="primary"
                type="submit"
                [disabled]="solutionForm.invalid || loading"
              >
                <span nz-icon [nzType]="loading ? 'loading' : 'save'"></span>
                {{ isEditMode ? 'Update Solution' : 'Create Solution' }}
              </button>
            </div>
          </nz-form-control>
        </nz-form-item>
      </form>
    </div>
  </div>
</div>
